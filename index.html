<!doctype html>
<html>
<head>
  <title>CodeMirror Sandbox</title>
  <meta charset="utf-8"/>

  <link rel=stylesheet href="codemirror-5.14.2/lib/codemirror.css">
  <script src="codemirror-5.14.2/lib/codemirror.js"></script>
  <script src="codemirror-5.14.2/mode/javascript/javascript.js"></script>
  <script src="diff_match_patch_20121119/javascript/diff_match_patch_uncompressed.js"></script>

  <style type="text/css">
    .newlines {
      min-width: 30px;
      background-color: lightgray;
    }
  </style>

</head>

<body>

  <div>
    <textarea id="myTextArea"></textarea>
  </div>

  <script type="text/javascript">
    var myCodeMirror = CodeMirror.fromTextArea(document.getElementById('myTextArea'), {
      mode: 'javascript',
      readOnly: true,
      lineNumbers: true,
      gutters: ['CodeMirror-linenumbers', 'newlines']
    });

    myCodeMirror.on('renderLine', (cm, line, elt) => {
      // console.log(line, elt);
    });

    var doc = myCodeMirror.getDoc();
    doc.setValue('function myScript(){\nreturn 100;\n }\n');

    doc.eachLine(line => {
      var lnb = doc.getLineNumber(line);
      myCodeMirror.setGutterMarker(line, 'newlines', document.createTextNode(lnb * 2));
    });
  </script>

  <hr/>

  <div>
    <textarea id="text1" cols="50" rows="5">
I am the very model of a modern Major-General,
I've information vegetable, animal, and mineral,
My animation's comical, unusual, and whimsical,
I know the kings of England, and I quote the fights historical,
From Marathon to Waterloo, in order categorical.
    </textarea>

    <textarea id="text2" cols="50" rows="5">
I am the very model of a cartoon individual,
My animation's comical, unusual, and whimsical,
I'm quite adept at funny gags, comedic theory I have read,
From wicked puns and stupid jokes to anvils that drop on your head.
    </textarea>
  </div>

  <button onclick="computeDiff()">Compute Diff</button>

  <div id="diff"></div>

  <script type="text/javascript">
    function computeDiff() {
      var text1 = document.getElementById('text1').value;
      var text2 = document.getElementById('text2').value;

      var dmp = new diff_match_patch();
      var lines = dmp.diff_linesToChars_(text1, text2);
      var diff = dmp.diff_main(lines.chars1, lines.chars2, false);
      dmp.diff_charsToLines_(diff, lines.lineArray);

      document.getElementById('diff').innerHTML = dmp.diff_prettyHtml(diff);
    }
  </script>

</body>
</html>
